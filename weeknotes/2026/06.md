# 2026 Week 6 DRAFT


# Custom authorizer for IOT core

New URL that supports username/password MQTT: `mqtt-fdri-ba.eds.ceh.ac.uk`

# COSMOS Loggers coming on board

# Bug with metadata and cosmos/nrfa not available in the UI

# AWS Migration

# Processed Data is being produced

# DAG update

# NRFA

A working MVP was completed last week which allows the NRFA team to upload data into batches, view the data in a UI for manual QC and then delete batches as required. We will be working with them over the next few weeks to test the tools alongside the upcoming data ingestion.

# Flux pipeline

Work continues on the eddy covariance pipeline.  Josh presented the initial architecture diagram at the All Things FDRI product showcase on Thursday.  Hamayoon has finished putting together a Docker image that is uploaded the the ECR repo, which will be necessary to run EddyPro in the AWS Kubernetes cluster.  Josh is still working through deciding the archictecture to extend the time series processor, what metadata is required to run the pipeline (both sensor information and processing configuration).  Current priorities are identifying the best way for the 20Hz data to be telemetered back into the system, deciding on the how to integrate into the timeseries-processor code, establishing the compute requirements to run EddyPro, and figuring out a data retention policy.

# Updates to TimeStream

Implemented new `AngularMean` aggregation method, which calculates the average angle over a given aggregation period. Used for calculating e.g. average daily wind direction.

# Updates to TimeSeries-Processor

- Merged new aggregation method for calculating `AngularMean`, used to calcualted the average wind direction over a given aggregation period. Uses the new `AngularMean` method implemented in TimeStream. See **Updates to TimeStream**.
- Merged new aggregation method `MeanRad`, used to calcualte the average radiation over a given aggregation period. This method includes a conversion factor to correct units to per day or per year instead of per seconds. This conversion factor is calculated from the aggregation period. 
- Developing new correction method 'Clip' to set data that is above or below a given threshold to that threshold value. This will be used to correct PE values below 0 to 0. This required updates to the metadata. See **Updates to Metadata**.

# Update to Metadata

Changes to `COSMOS_TS_ID_DEPENDENCIES.json`:

- `PE_30MIN_PROCESSED` datasets/keys were relabelled as `PE_30MIN_RAW` for all cosmos sites
- New `PE_30MIN_PROCESSED` dataset/key was added for each site. This depends on the `PE_30MIN_RAW` data via a `PROCESS`
- `PE_1DAY_PROCESSED' dataset values were updated so that the derivation was set to `AGGREGATE` using the method `mean_sum`

Changes to `CORRECTION_CONFIG.json`

- Added dataset for each site with `CORRECT_TS` set to `COSMOS-{site}-PE_30MIN_RAW` to specify the correction required during the `PROCESS` step. The `METHOD_ID` was set to `CLIP` and parameters `PARAM_ID = MIN` and `PARAM_VALUE = 0`. This ensures that any negative values in the PE data is set to 0.

Supplementary Changes:

- Information on the `CLIP` method and parameters `MIN` and `MAX` were added to `CORRECTION_METHOD_PARAMS.csv`, `CORRECTION_METHODS.csv` and `CORRECTION_PARAMS.csv`
- Information on the raw data was added to `TIMESERIES_IDS_COSMOS.csv`. **Note**: A source was not required and hence was not specified. The metadata model may need to be updated to allow this field to be empty.
